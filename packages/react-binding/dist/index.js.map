{"version":3,"file":"index.js","sources":["../../../node_modules/tslib/tslib.es6.js","../../base/dist/index.js","../src/components/PixelDust/PixelDust.tsx"],"sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n","import { map, distinctUntilChanged, tap, filter, first, switchMap, takeUntil, finalize, takeWhile, mapTo, repeat, groupBy, reduce, share } from 'rxjs/operators';\nimport { Subject, fromEvent, concat, merge } from 'rxjs';\nimport { v4 } from 'uuid';\n\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n\r\nvar __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\n\r\nfunction __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nfunction __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\n\n/** Pixel Canvas types */\nvar CanvasType;\n(function (CanvasType) {\n    CanvasType[CanvasType[\"X50\"] = 50] = \"X50\";\n    CanvasType[CanvasType[\"X100\"] = 100] = \"X100\";\n    CanvasType[CanvasType[\"X200\"] = 200] = \"X200\";\n    CanvasType[CanvasType[\"X500\"] = 500] = \"X500\";\n})(CanvasType || (CanvasType = {}));\nvar LayerCommandType;\n(function (LayerCommandType) {\n    LayerCommandType[\"ADD_AFTER\"] = \"ADD_AFTER\";\n    LayerCommandType[\"ADD_BEFORE\"] = \"ADD_BEFORE\";\n    LayerCommandType[\"DELETE\"] = \"DELETE\";\n    LayerCommandType[\"REARRANGE\"] = \"REARRANGE\";\n    LayerCommandType[\"HIDE\"] = \"HIDE\";\n    LayerCommandType[\"SHOW\"] = \"SHOW\";\n    LayerCommandType[\"INSERT_BEFORE\"] = \"INSERT_BEFORE\";\n    LayerCommandType[\"INSERT_AFTER\"] = \"INSERT_AFTER\";\n})(LayerCommandType || (LayerCommandType = {}));\n/** Command Generator types */\nvar InstrumentType;\n(function (InstrumentType) {\n    InstrumentType[\"PEN\"] = \"PEN\";\n    InstrumentType[\"FILL\"] = \"FILL\";\n    InstrumentType[\"ERASER\"] = \"ERASER\";\n    InstrumentType[\"PIXEL_SQUARE\"] = \"PIXEL_SQUARE\";\n    InstrumentType[\"PIXEL_CIRCLE\"] = \"PIXEL_CIRCLE\";\n    InstrumentType[\"COLOR_PICKER\"] = \"COLOR_PICKER\";\n})(InstrumentType || (InstrumentType = {}));\n\nvar CommandGenerator = /** @class */ (function () {\n    function CommandGenerator(options) {\n        var _this = this;\n        this.layerCommand$ = new Subject();\n        this.drawingState = {\n            foregroundColor: 'rgb(0, 0, 0, 1)',\n            backgroundColor: 'rgb(255, 255, 255, 1)',\n            instrument: InstrumentType.PEN\n        };\n        this.canvasCommand$ = options.drawStream.pipe(map(function (_a) {\n            var x = _a.x, y = _a.y;\n            return ({ u: x / options.dimension, v: y / options.dimension });\n        }), map(function (_a) {\n            var u = _a.u, v = _a.v;\n            return ({\n                x: Math.floor(u * options.canvasType),\n                y: Math.floor(v * options.canvasType)\n            });\n        }), map(function (_a) {\n            var x = _a.x, y = _a.y;\n            switch (_this.drawingState.instrument) {\n                case InstrumentType.PEN:\n                    return {\n                        x: x,\n                        y: y,\n                        color: _this.drawingState.foregroundColor,\n                        instrument: InstrumentType.PEN\n                    };\n                case InstrumentType.PIXEL_SQUARE:\n                    return {\n                        x: x,\n                        y: y,\n                        color: _this.drawingState.foregroundColor,\n                        instrument: InstrumentType.PIXEL_SQUARE\n                    };\n                case InstrumentType.ERASER:\n                    return {\n                        x: x,\n                        y: y,\n                        instrument: InstrumentType.ERASER\n                    };\n                default:\n                    throw new Error('Draw command not supported');\n            }\n        }), distinctUntilChanged(function (prev, curr) {\n            if (prev && curr) {\n                if (prev.x !== curr.x || prev.y !== curr.y || prev.instrument !== curr.instrument) {\n                    return false;\n                }\n                if (prev.color && curr.color) {\n                    if (prev.color !== curr.color) {\n                        return false;\n                    }\n                    return true;\n                }\n            }\n            return true;\n        }));\n        this.previewCanvasCommand$ = options.previewStream.pipe(map(function (_a) {\n            var x = _a.x, y = _a.y;\n            return ({ u: x / options.dimension, v: y / options.dimension });\n        }), map(function (_a) {\n            var u = _a.u, v = _a.v;\n            return ({\n                x: Math.floor(u * options.canvasType),\n                y: Math.floor(v * options.canvasType)\n            });\n        }), map(function (_a) {\n            var x = _a.x, y = _a.y;\n            switch (_this.drawingState.instrument) {\n                case InstrumentType.PEN:\n                    return {\n                        x: x,\n                        y: y,\n                        color: _this.drawingState.foregroundColor,\n                        instrument: InstrumentType.PEN\n                    };\n                case InstrumentType.PIXEL_SQUARE:\n                    return {\n                        x: x,\n                        y: y,\n                        color: _this.drawingState.foregroundColor,\n                        instrument: InstrumentType.PIXEL_SQUARE\n                    };\n                case InstrumentType.ERASER:\n                    return {\n                        x: x,\n                        y: y,\n                        instrument: InstrumentType.ERASER\n                    };\n                default:\n                    throw new Error('Preview command not supported');\n            }\n        }), distinctUntilChanged(function (prev, curr) {\n            if (prev && curr) {\n                if (prev.x !== curr.x || prev.y !== curr.y || prev.instrument !== curr.instrument) {\n                    return false;\n                }\n                if (prev.color && curr.color) {\n                    if (prev.color !== curr.color) {\n                        return false;\n                    }\n                    return true;\n                }\n            }\n            return true;\n        }));\n    }\n    // eslint-disable-next-line class-methods-use-this\n    CommandGenerator.prototype.cleanUp = function () {\n        console.info('clean up for command generator called');\n    };\n    return CommandGenerator;\n}());\n\nvar EventManager = /** @class */ (function () {\n    function EventManager(options) {\n        var _this = this;\n        this.canvasMoveCache = {\n            prevX: 0,\n            prevY: 0,\n            initX: 0,\n            initY: 0,\n            isMoving: false\n        };\n        this.canvasScaleCache = {\n            scale: 1\n        };\n        this.targetElement = options.canvasContainerElement;\n        this.containerElement = options.stage;\n        var mouseDown$ = fromEvent(this.targetElement, 'mousedown');\n        var mouseMove$ = fromEvent(this.targetElement, 'mousemove');\n        var mouseUp$ = fromEvent(window, 'mouseup');\n        var mouseLeave$ = fromEvent(this.targetElement, 'mouseleave');\n        var wheel$ = fromEvent(this.containerElement, 'wheel').pipe(tap(function (event) {\n            event.preventDefault();\n        }));\n        var spaceKeyDown$ = fromEvent(window, 'keydown').pipe(filter(function (event) { return event.code === 'Space'; }));\n        var spaceKeyUp$ = fromEvent(window, 'keyup').pipe(filter(function (event) { return event.code === 'Space'; }));\n        var ctrlKeyDown$ = fromEvent(window, 'keydown').pipe(filter(function (event) { return event.code === 'ControlLeft'; }));\n        var ctrlKeyUp$ = fromEvent(window, 'keyup').pipe(filter(function (event) { return event.code === 'ControlLeft'; }));\n        var zKeyDown$ = fromEvent(window, 'keydown').pipe(filter(function (event) { return event.code === 'KeyZ'; }));\n        this.canvasMove$ = spaceKeyDown$.pipe(first(), tap(function () {\n            _this.canvasMoveCache.isMoving = true;\n            options.canvasContainerElement.style.setProperty('cursor', 'grab');\n        }), switchMap(function () {\n            return concat(mouseDown$.pipe(first(), tap(function (event) {\n                var x = event.x, y = event.y;\n                _this.canvasMoveCache.prevX = x;\n                _this.canvasMoveCache.prevY = y;\n            })), mouseMove$);\n        }), map(function (event) {\n            var x = event.x, y = event.y;\n            var _a = _this.canvasMoveCache, prevX = _a.prevX, prevY = _a.prevY, initX = _a.initX, initY = _a.initY;\n            var nextX = x - prevX + initX;\n            var nextY = y - prevY + initY;\n            _this.canvasMoveCache.prevX = x;\n            _this.canvasMoveCache.prevY = y;\n            _this.canvasMoveCache.initX = nextX;\n            _this.canvasMoveCache.initY = nextY;\n            return {\n                x: nextX,\n                y: nextY\n            };\n        }), takeUntil(spaceKeyUp$), takeUntil(mouseUp$), finalize(function () {\n            _this.canvasMoveCache.isMoving = false;\n            options.canvasContainerElement.style.setProperty('cursor', 'unset');\n        }));\n        this.canvasScale$ = wheel$.pipe(filter(function (event) { return event.ctrlKey; }), map(function (event) {\n            var prevScale = _this.canvasScaleCache.scale;\n            if (event.deltaY < 0) {\n                if (prevScale >= 2) {\n                    return _this.canvasScaleCache;\n                }\n                _this.canvasScaleCache = {\n                    scale: prevScale + 0.1\n                };\n                return _this.canvasScaleCache;\n            }\n            if (prevScale <= 0.7) {\n                return _this.canvasScaleCache;\n            }\n            _this.canvasScaleCache = {\n                scale: prevScale - 0.1\n            };\n            return _this.canvasScaleCache;\n        }));\n        this.canvasDraw$ = concat(mouseDown$.pipe(first()), mouseMove$).pipe(takeWhile(function () { return !_this.canvasMoveCache.isMoving; }), takeUntil(mouseUp$), map(function (event) { return ({ x: event.offsetX, y: event.offsetY }); }));\n        this.canvasPreview$ = mouseMove$.pipe(takeUntil(mouseLeave$), map(function (event) {\n            return { x: event.offsetX, y: event.offsetY };\n        }));\n        this.undoStream$ = ctrlKeyDown$.pipe(switchMap(function () { return zKeyDown$; }), mapTo(undefined), takeUntil(ctrlKeyUp$));\n    }\n    // eslint-disable-next-line class-methods-use-this\n    EventManager.prototype.cleanUp = function () {\n        console.info('clean up for event manager called');\n    };\n    return EventManager;\n}());\n\nvar CommandHistory = /** @class */ (function () {\n    function CommandHistory(_a) {\n        var _this = this;\n        var drawCommand$ = _a.drawCommand$, layerCommand$ = _a.layerCommand$;\n        this.redoStack = [];\n        this.subscriptions = [];\n        this.subscriptions.push(merge(drawCommand$, layerCommand$).subscribe({\n            next: function (command) {\n                console.log(command);\n                _this.redoStack.push(command);\n            }\n        }));\n    }\n    CommandHistory.prototype.cleanUp = function () {\n        this.subscriptions.forEach(function (subscription) {\n            subscription.unsubscribe();\n        });\n    };\n    return CommandHistory;\n}());\n\nvar ExecutionPipeline = /** @class */ (function () {\n    function ExecutionPipeline(options) {\n        var _this = this;\n        this.subscriptions = [];\n        this.layerManager = options.layerManager;\n        this.commandGenerator = options.commandGenerator;\n        this.previewCanvas = options.previewCanvas;\n        this.subscriptions.push(this.commandGenerator.previewCanvasCommand$\n            .pipe(finalize(function () {\n            _this.previewCanvas.refresh();\n        }), repeat())\n            .subscribe({\n            next: function (command) {\n                _this.previewCanvas.preview(command);\n            }\n        }));\n        var drawCommand$ = this.commandGenerator.canvasCommand$.pipe(filter(function () { return !!_this.layerManager.activeLayer; }), map(function (command) {\n            var _a, _b;\n            if (!((_a = _this.layerManager.activeLayer) === null || _a === void 0 ? void 0 : _a.uuid)) {\n                throw new Error('Active layer needed to store history');\n            }\n            return __assign(__assign({}, command), { activeLayerUuid: (_b = _this.layerManager.activeLayer) === null || _b === void 0 ? void 0 : _b.uuid });\n        }), tap(function (command) {\n            var _a;\n            (_a = _this.layerManager.activeLayer) === null || _a === void 0 ? void 0 : _a.pixelCanvas.execute(command);\n        }), groupBy(function (command) { return command.instrument; }), switchMap(function (command$) {\n            return command$.pipe(reduce(function (acc, command) {\n                if (command.instrument === InstrumentType.PEN) {\n                    acc.color = command.color;\n                }\n                acc.instrument = command.instrument;\n                acc.activeLayerUuid = command.activeLayerUuid;\n                acc.cartesianArray.push({ x: command.x, y: command.y });\n                return acc;\n            }, {\n                instrument: InstrumentType.PEN,\n                color: undefined,\n                activeLayerUuid: '',\n                cartesianArray: []\n            }));\n        }), repeat(), share());\n        var layerCommand$ = this.commandGenerator.layerCommand$.pipe(map(function (command) { return _this.layerManager.execute(command); }));\n        this.commandHistory = new CommandHistory({\n            drawCommand$: drawCommand$,\n            layerCommand$: layerCommand$\n        });\n        this.subscriptions.push(drawCommand$.subscribe({\n            next: function (command) {\n                _this.layerManager.updateLayerPreview(command.activeLayerUuid);\n            }\n        }));\n    }\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    ExecutionPipeline.prototype.undo = function (count) {\n        // find out type of command\n        var numberOfCommands = this.commandHistory.redoStack.length;\n        if (numberOfCommands >= 1) {\n            var lastCommand = this.commandHistory.redoStack[numberOfCommands - 1];\n            console.log(lastCommand);\n        }\n        else {\n            throw Error('Undo cannot be performed');\n        }\n    };\n    ExecutionPipeline.prototype.cleanUp = function () {\n        this.commandHistory.cleanUp();\n        this.subscriptions.forEach(function (subscription) {\n            subscription.unsubscribe();\n        });\n    };\n    return ExecutionPipeline;\n}());\n\nvar PixelCanvas = /** @class */ (function () {\n    function PixelCanvas(canvasType, dimension, uuid) {\n        this.dimension = dimension;\n        this.canvasType = canvasType;\n        this.tileDimension = dimension / canvasType;\n        this.canvas = document.createElement('canvas');\n        this.canvas.classList.add('pixel-canvas');\n        this.canvas.height = dimension;\n        this.canvas.width = dimension;\n        this.canvas.setAttribute('id', uuid);\n        var ctx = this.canvas.getContext('2d');\n        if (ctx) {\n            this.ctx = ctx;\n        }\n        else {\n            throw Error('Context is null');\n        }\n    }\n    PixelCanvas.prototype.execute = function (command) {\n        switch (command.instrument) {\n            case InstrumentType.PEN:\n                this.ctx.fillStyle = command.color;\n                this.ctx.fillRect(Math.round(command.x * this.tileDimension), Math.round(command.y * this.tileDimension), this.tileDimension, this.tileDimension);\n                break;\n            case InstrumentType.PIXEL_SQUARE:\n                this.ctx.fillStyle = command.color;\n                this.ctx.fillRect(Math.round(command.x * this.tileDimension - 16), Math.round(command.y * this.tileDimension - 16), this.tileDimension * 5, this.tileDimension * 5);\n                break;\n            case InstrumentType.ERASER:\n                this.ctx.clearRect(Math.round(command.x * this.tileDimension), Math.round(command.y * this.tileDimension), this.tileDimension, this.tileDimension);\n                break;\n        }\n    };\n    PixelCanvas.prototype.getCanvasBlob = function (type, quality) {\n        var _this = this;\n        return new Promise(function (resolve) {\n            _this.canvas.toBlob(function (blob) {\n                resolve(blob);\n            }, type !== null && type !== void 0 ? type : 'img/png', quality);\n        });\n    };\n    return PixelCanvas;\n}());\n\nvar LayerManager = /** @class */ (function () {\n    function LayerManager(options) {\n        this.activeLayer = null;\n        this.layerStackUpdateCB = undefined;\n        this.activeLayerUpdateCB = undefined;\n        this.layerStack = [];\n        this.dimension = options.dimension;\n        this.canvasType = options.canvasType;\n        this.canvasLayerWrapperElement = document.createElement('div');\n        this.canvasLayerWrapperElement.classList.add('canvas-layer-wrapper');\n        options.canvasContainerElement.appendChild(this.canvasLayerWrapperElement);\n    }\n    // eslint-disable-next-line class-methods-use-this\n    LayerManager.prototype.cleanUp = function () {\n        console.info('clean up for layer manager called');\n    };\n    LayerManager.prototype.setActiveLayer = function (arg) {\n        if (arg) {\n            var filterOutput = this.layerStack.filter(function (layer) { return layer.uuid === arg.uuid; });\n            if (filterOutput.length > 1) {\n                throw Error('uuid matches more than one layer');\n            }\n            else if (filterOutput.length < 1) {\n                throw Error('uuid does not match any layer');\n            }\n            else {\n                var layer = filterOutput[0];\n                this.activeLayer = layer;\n            }\n        }\n        else {\n            this.activeLayer = null;\n        }\n        if (this.activeLayerUpdateCB)\n            this.activeLayerUpdateCB(this.activeLayer);\n    };\n    LayerManager.prototype.getActiveLayer = function () {\n        return this.activeLayer;\n    };\n    LayerManager.prototype.getActiveLayerUUID = function () {\n        var _a, _b;\n        return (_b = (_a = this.activeLayer) === null || _a === void 0 ? void 0 : _a.uuid) !== null && _b !== void 0 ? _b : null;\n    };\n    LayerManager.prototype.addLayerAfter = function (arg) {\n        if (!(arg === null || arg === void 0 ? void 0 : arg.uuid)) {\n            var uuid_1 = v4();\n            var layer_1 = {\n                pixelCanvas: new PixelCanvas(this.canvasType, this.dimension, uuid_1),\n                uuid: uuid_1,\n                hidden: false\n            };\n            this.canvasLayerWrapperElement.appendChild(layer_1.pixelCanvas.canvas);\n            this.layerStack.push(layer_1);\n            if (this.layerStackUpdateCB)\n                this.layerStackUpdateCB(this.layerStack.map(function (_layer) { return ({\n                    uuid: _layer.uuid,\n                    imagePreview: _layer.imagePreview,\n                    hidden: _layer.hidden\n                }); }));\n            return layer_1;\n        }\n        // TODO: If uuid provided\n        var uuid = v4();\n        var layer = {\n            pixelCanvas: new PixelCanvas(this.canvasType, this.dimension, uuid),\n            uuid: uuid,\n            hidden: false\n        };\n        this.layerStack.push(layer);\n        return layer;\n    };\n    LayerManager.prototype.hideLayer = function (arg) {\n        var layer = this.layerStack.find(function (_layer) { return _layer.uuid === arg.uuid; });\n        if (layer) {\n            layer.hidden = true;\n            layer.pixelCanvas.canvas.style.setProperty('opacity', '0');\n        }\n        if (this.layerStackUpdateCB)\n            this.layerStackUpdateCB(this.layerStack.map(function (_layer) { return ({\n                uuid: _layer.uuid,\n                imagePreview: _layer.imagePreview,\n                hidden: _layer.hidden\n            }); }));\n    };\n    LayerManager.prototype.showLayer = function (arg) {\n        var layer = this.layerStack.find(function (_layer) { return _layer.uuid === arg.uuid; });\n        if (layer) {\n            layer.hidden = false;\n            layer.pixelCanvas.canvas.style.setProperty('opacity', '1');\n        }\n        if (this.layerStackUpdateCB)\n            this.layerStackUpdateCB(this.layerStack.map(function (_layer) { return ({\n                uuid: _layer.uuid,\n                imagePreview: _layer.imagePreview,\n                hidden: _layer.hidden\n            }); }));\n    };\n    LayerManager.prototype.addLayerBefore = function (arg) {\n        console.log(arg);\n        var uuid = v4();\n        var layer = {\n            pixelCanvas: new PixelCanvas(this.canvasType, this.dimension, uuid),\n            uuid: uuid,\n            hidden: false\n        };\n        for (var idx = 0, length_1 = this.layerStack.length; idx < length_1; idx += 1) {\n            if (this.layerStack[idx].uuid === arg.uuid) {\n                this.canvasLayerWrapperElement.insertBefore(layer.pixelCanvas.canvas, this.layerStack[idx].pixelCanvas.canvas);\n                this.layerStack.splice(idx, 0, layer);\n                break;\n            }\n        }\n        if (this.layerStackUpdateCB)\n            this.layerStackUpdateCB(this.layerStack.map(function (_layer) { return ({\n                uuid: _layer.uuid,\n                imagePreview: _layer.imagePreview,\n                hidden: _layer.hidden\n            }); }));\n        return layer;\n    };\n    LayerManager.prototype.deleteLayer = function (arg) {\n        var _a = this.layerStack.filter(function (layer) { return layer.uuid === arg.uuid; }), selectedLayer = _a[0], rest = _a.slice(1);\n        if (rest.length > 0) {\n            throw Error('uuid matches more than one layer');\n        }\n        if (!selectedLayer) {\n            throw Error('uuid does not match any layer');\n        }\n        this.canvasLayerWrapperElement.removeChild(selectedLayer.pixelCanvas.canvas);\n        this.layerStack = this.layerStack.filter(function (layer) { return layer.uuid !== selectedLayer.uuid; });\n        if (this.layerStackUpdateCB)\n            this.layerStackUpdateCB(this.layerStack.map(function (_layer) { return ({\n                uuid: _layer.uuid,\n                imagePreview: _layer.imagePreview,\n                hidden: _layer.hidden\n            }); }));\n        this.setActiveLayer(null);\n    };\n    LayerManager.prototype.insertLayerBefore = function (arg) {\n        var destinationLayer = this.layerStack.find(function (_layer) { return _layer.uuid === arg.destinationUuid; });\n        var layer = this.layerStack.find(function (_layer) { return _layer.uuid === arg.uuid; });\n        if (layer && destinationLayer) {\n            var filteredLayerStack = this.layerStack.filter(function (_layer) { return _layer.uuid !== arg.uuid; });\n            for (var idx = 0, length_2 = filteredLayerStack.length; idx < length_2; idx += 1) {\n                if (filteredLayerStack[idx].uuid === arg.destinationUuid) {\n                    filteredLayerStack.splice(idx, 0, layer);\n                    this.layerStack = filteredLayerStack;\n                    this.canvasLayerWrapperElement.insertBefore(layer.pixelCanvas.canvas, destinationLayer.pixelCanvas.canvas);\n                    break;\n                }\n            }\n            if (this.layerStackUpdateCB)\n                this.layerStackUpdateCB(this.layerStack.map(function (_layer) { return ({\n                    uuid: _layer.uuid,\n                    imagePreview: _layer.imagePreview,\n                    hidden: _layer.hidden\n                }); }));\n        }\n    };\n    LayerManager.prototype.insertLayerAfter = function (arg) {\n        var destinationLayer = this.layerStack.find(function (_layer) { return _layer.uuid === arg.destinationUuid; });\n        var layer = this.layerStack.find(function (_layer) { return _layer.uuid === arg.uuid; });\n        if (layer && destinationLayer) {\n            var filteredLayerStack = this.layerStack.filter(function (_layer) { return _layer.uuid !== arg.uuid; });\n            for (var idx = 0, length_3 = filteredLayerStack.length; idx < length_3; idx += 1) {\n                if (filteredLayerStack[idx].uuid === arg.destinationUuid) {\n                    if (idx === filteredLayerStack.length - 1) {\n                        filteredLayerStack.push(layer);\n                    }\n                    else {\n                        filteredLayerStack.splice(idx + 1, 0, layer);\n                    }\n                    this.layerStack = filteredLayerStack;\n                    this.canvasLayerWrapperElement.insertBefore(layer.pixelCanvas.canvas, destinationLayer.pixelCanvas.canvas.nextSibling);\n                    break;\n                }\n            }\n            if (this.layerStackUpdateCB)\n                this.layerStackUpdateCB(this.layerStack.map(function (_layer) { return ({\n                    uuid: _layer.uuid,\n                    imagePreview: _layer.imagePreview,\n                    hidden: _layer.hidden\n                }); }));\n        }\n    };\n    LayerManager.prototype.execute = function (command) {\n        switch (command.type) {\n            case LayerCommandType.ADD_AFTER: {\n                var generatedUuid = this.addLayerAfter({\n                    uuid: command.uuid\n                }).uuid;\n                return __assign(__assign({}, command), { generatedUuid: generatedUuid });\n            }\n            case LayerCommandType.ADD_BEFORE: {\n                console.log(command);\n                var generatedUuid = this.addLayerBefore({\n                    uuid: command.uuid\n                }).uuid;\n                return __assign(__assign({}, command), { generatedUuid: generatedUuid });\n            }\n            case LayerCommandType.DELETE: {\n                this.deleteLayer({ uuid: command.uuid });\n                return command;\n            }\n            case LayerCommandType.HIDE: {\n                this.hideLayer({ uuid: command.uuid });\n                return command;\n            }\n            case LayerCommandType.SHOW: {\n                this.showLayer({ uuid: command.uuid });\n                return command;\n            }\n            case LayerCommandType.INSERT_AFTER: {\n                this.insertLayerAfter({\n                    uuid: command.uuid,\n                    destinationUuid: command.destinationUuid\n                });\n                return command;\n            }\n            case LayerCommandType.INSERT_BEFORE: {\n                this.insertLayerBefore({\n                    uuid: command.uuid,\n                    destinationUuid: command.destinationUuid\n                });\n                return command;\n            }\n            default:\n                throw new Error('Layer command not supported');\n        }\n    };\n    LayerManager.prototype.updateLayerPreview = function (uuid) {\n        return __awaiter(this, void 0, void 0, function () {\n            var layer, blob;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        layer = this.layerStack.find(function (_layer) { return _layer.uuid === uuid; });\n                        if (!layer) return [3 /*break*/, 2];\n                        return [4 /*yield*/, layer.pixelCanvas.getCanvasBlob()];\n                    case 1:\n                        blob = _a.sent();\n                        layer.imagePreview = URL.createObjectURL(blob);\n                        _a.label = 2;\n                    case 2:\n                        if (this.layerStackUpdateCB)\n                            this.layerStackUpdateCB(this.layerStack.map(function (_layer) { return ({\n                                uuid: _layer.uuid,\n                                imagePreview: _layer.imagePreview,\n                                hidden: _layer.hidden\n                            }); }));\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    LayerManager.prototype.exportImage = function (name, format) {\n        if (name === void 0) { name = 'my-project'; }\n        if (format === void 0) { format = 'img/png'; }\n        return __awaiter(this, void 0, void 0, function () {\n            var exportCanvas, ctx, generateBlob, blob, imageUrl, a;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        exportCanvas = document.createElement('canvas');\n                        exportCanvas.height = this.dimension;\n                        exportCanvas.width = this.dimension;\n                        ctx = exportCanvas.getContext('2d');\n                        this.layerStack.forEach(function (layer) {\n                            ctx === null || ctx === void 0 ? void 0 : ctx.drawImage(layer.pixelCanvas.canvas, 0, 0, _this.dimension, _this.dimension);\n                        });\n                        generateBlob = new Promise(function (resolve) {\n                            exportCanvas.toBlob(function (blob) {\n                                resolve(blob);\n                            }, format);\n                        });\n                        return [4 /*yield*/, generateBlob];\n                    case 1:\n                        blob = _a.sent();\n                        imageUrl = URL.createObjectURL(blob);\n                        a = document.createElement('a');\n                        a.setAttribute('download', name);\n                        a.setAttribute('href', imageUrl);\n                        a.click();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    return LayerManager;\n}());\n\nvar GuideCanvas = /** @class */ (function () {\n    function GuideCanvas(canvasType, dimension, mountTarget) {\n        this.dimension = dimension;\n        this.canvasType = canvasType;\n        this.tileDimension = dimension / canvasType;\n        this.canvas = document.createElement('canvas');\n        this.canvas.classList.add('canvas-guide');\n        this.canvas.height = dimension;\n        this.canvas.width = dimension;\n        mountTarget.appendChild(this.canvas);\n        var ctx = this.canvas.getContext('2d');\n        if (ctx) {\n            this.ctx = ctx;\n        }\n        else {\n            throw Error('Context is null');\n        }\n        this.drawGuideLines();\n    }\n    GuideCanvas.prototype.drawGuideLines = function () {\n        this.ctx.strokeStyle = '#E9F1F1';\n        this.ctx.lineWidth = 1;\n        for (var i = this.tileDimension; i < this.canvas.width; i += this.tileDimension) {\n            this.ctx.moveTo(0, i);\n            this.ctx.lineTo(this.canvas.width, i);\n            this.ctx.stroke();\n        }\n        for (var i = this.tileDimension; i < this.canvas.width; i += this.tileDimension) {\n            this.ctx.moveTo(i, 0);\n            this.ctx.lineTo(i, this.canvas.width);\n            this.ctx.stroke();\n        }\n    };\n    return GuideCanvas;\n}());\n\nvar PreviewCanvas = /** @class */ (function () {\n    function PreviewCanvas(canvasType, dimension, mountTarget) {\n        this.lastCommand = null;\n        this.dimension = dimension;\n        this.canvasType = canvasType;\n        this.tileDimension = dimension / canvasType;\n        this.canvas = document.createElement('canvas');\n        this.canvas.classList.add('preview-canvas');\n        this.canvas.height = dimension;\n        this.canvas.width = dimension;\n        mountTarget.appendChild(this.canvas);\n        var ctx = this.canvas.getContext('2d');\n        if (ctx) {\n            this.ctx = ctx;\n        }\n        else {\n            throw Error('Context is null');\n        }\n    }\n    PreviewCanvas.prototype.preview = function (command) {\n        this.refresh();\n        this.lastCommand = command;\n        switch (command.instrument) {\n            case InstrumentType.PEN:\n                this.ctx.fillStyle = command.color.replace(/[\\d.]+\\)$/g, '0.4)');\n                this.ctx.fillRect(Math.round(command.x * this.tileDimension), Math.round(command.y * this.tileDimension), this.tileDimension, this.tileDimension);\n                break;\n            case InstrumentType.PIXEL_SQUARE:\n                this.ctx.fillStyle = command.color.replace(/[\\d.]+\\)$/g, '0.4)');\n                this.ctx.fillRect(Math.round(command.x * this.tileDimension - 16), Math.round(command.y * this.tileDimension - 16), this.tileDimension * 5, this.tileDimension * 5);\n                break;\n            case InstrumentType.ERASER:\n                this.ctx.fillStyle = '#ffffff';\n                this.ctx.fillRect(Math.round(command.x * this.tileDimension), Math.round(command.y * this.tileDimension), this.tileDimension, this.tileDimension);\n                break;\n        }\n    };\n    PreviewCanvas.prototype.refresh = function () {\n        var _a;\n        switch ((_a = this.lastCommand) === null || _a === void 0 ? void 0 : _a.instrument) {\n            case InstrumentType.PEN:\n                this.ctx.clearRect(Math.round(this.lastCommand.x * this.tileDimension), Math.round(this.lastCommand.y * this.tileDimension), this.tileDimension, this.tileDimension);\n                break;\n            case InstrumentType.PIXEL_SQUARE:\n                this.ctx.clearRect(Math.round(this.lastCommand.x * this.tileDimension - 16), Math.round(this.lastCommand.y * this.tileDimension - 16), this.tileDimension * 5, this.tileDimension * 5);\n                break;\n            case InstrumentType.ERASER:\n                this.ctx.clearRect(Math.round(this.lastCommand.x * this.tileDimension), Math.round(this.lastCommand.y * this.tileDimension), this.tileDimension, this.tileDimension);\n                break;\n        }\n    };\n    return PreviewCanvas;\n}());\n\nfunction styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nvar css_248z = \".pixel-dust-stage {\\n  background-color: #444444;\\n  height: 100%;\\n  width: 100%;\\n  display: flex;\\n  justify-content: center;\\n  align-items: center;\\n  overflow: hidden;\\n}\\n\\n.pixel-dust-canvas-container {\\n  position: relative;\\n  background-color: #ffffff;\\n  --stage-scale: 1;\\n  --stage-pos-x: 0;\\n  --stage-pos-y: 0;\\n  transform: translateX(calc(var(--stage-pos-x) * 1px)) translateY(calc(var(--stage-pos-y) * 1px))\\n    scale(var(--stage-scale));\\n  will-change: transform;\\n}\\n\\n.pixel-canvas {\\n  position: absolute;\\n  top: 0;\\n  left: 0;\\n}\\n\\n.canvas-guide,\\n.preview-canvas {\\n  pointer-events: none;\\n  position: absolute;\\n}\\n\";\nstyleInject(css_248z);\n\nvar PixelDustEngine = /** @class */ (function () {\n    function PixelDustEngine(_a) {\n        var _this = this;\n        var mountTarget = _a.mountTarget, dimension = _a.dimension, canvasType = _a.canvasType;\n        this.subscriptions = [];\n        this.containerPosition = {\n            x: 0,\n            y: 0,\n            top: 0,\n            left: 0,\n            height: 0,\n            width: 0\n        };\n        this.computationCache = {\n            containerX: 0,\n            containerY: 0\n        };\n        this.mountTarget = mountTarget;\n        // Create stage (area with gray background)\n        this.stage = document.createElement('div');\n        this.stage.classList.add('pixel-dust-stage');\n        // Create canvas container (the white area also responsible for dealing with interaction events)\n        this.pixelDustCanvasContainer = document.createElement('div');\n        this.pixelDustCanvasContainer.classList.add('pixel-dust-canvas-container');\n        this.pixelDustCanvasContainer.style.setProperty('height', dimension + \"px\");\n        this.pixelDustCanvasContainer.style.setProperty('width', dimension + \"px\");\n        // Add canvas container to stage\n        this.stage.appendChild(this.pixelDustCanvasContainer);\n        // Add stage to mount point\n        this.mountTarget.appendChild(this.stage);\n        // Initialize event manager for getting interaction streams\n        this.eventManager = new EventManager({\n            canvasContainerElement: this.pixelDustCanvasContainer,\n            stage: this.stage\n        });\n        // Initialize layer manager for handling canvas layers and active layer\n        this.layerManager = new LayerManager({\n            canvasType: canvasType,\n            dimension: dimension,\n            canvasContainerElement: this.pixelDustCanvasContainer\n        });\n        // Initialize command generator\n        this.commandGenerator = new CommandGenerator({\n            dimension: dimension,\n            canvasType: canvasType,\n            drawStream: this.eventManager.canvasDraw$,\n            previewStream: this.eventManager.canvasPreview$\n        });\n        this.guideCanvas = new GuideCanvas(canvasType, dimension, this.pixelDustCanvasContainer);\n        this.previewCanvas = new PreviewCanvas(canvasType, dimension, this.pixelDustCanvasContainer);\n        // Initialize execution pipeline\n        this.executionPipeline = new ExecutionPipeline({\n            layerManager: this.layerManager,\n            commandGenerator: this.commandGenerator,\n            previewCanvas: this.previewCanvas\n        });\n        // use event manager move stream to deal with canvas move\n        this.subscriptions.push(this.eventManager.canvasMove$.pipe(repeat()).subscribe({\n            next: function (arg) {\n                var _a, _b;\n                var x = arg.x, y = arg.y;\n                (_a = _this.pixelDustCanvasContainer) === null || _a === void 0 ? void 0 : _a.style.setProperty('--stage-pos-x', String(x));\n                (_b = _this.pixelDustCanvasContainer) === null || _b === void 0 ? void 0 : _b.style.setProperty('--stage-pos-y', String(y));\n            },\n            complete: function () { },\n            error: function (error) { return console.error(error); }\n        }));\n        // use event manager scroll stream to deal with canvas scale\n        this.subscriptions.push(this.eventManager.canvasScale$.subscribe({\n            next: function (arg) {\n                var _a;\n                (_a = _this.pixelDustCanvasContainer) === null || _a === void 0 ? void 0 : _a.style.setProperty('--stage-scale', String(arg.scale));\n            },\n            complete: function () { },\n            error: function (error) { return console.error(error); }\n        }));\n        // use event manager undo stream to deal with undo commands\n        this.subscriptions.push(this.eventManager.undoStream$.subscribe({\n            next: function () {\n                _this.executionPipeline.undo();\n            },\n            complete: function () { },\n            error: function (error) { return console.error(error); }\n        }));\n    }\n    PixelDustEngine.prototype.cleanUp = function () {\n        var _a, _b, _c, _d;\n        (_a = this.layerManager) === null || _a === void 0 ? void 0 : _a.cleanUp();\n        (_b = this.commandGenerator) === null || _b === void 0 ? void 0 : _b.cleanUp();\n        (_c = this.executionPipeline) === null || _c === void 0 ? void 0 : _c.cleanUp();\n        (_d = this.eventManager) === null || _d === void 0 ? void 0 : _d.cleanUp();\n        this.subscriptions.forEach(function (subscription) {\n            subscription.unsubscribe();\n        });\n        this.mountTarget.innerHTML = '';\n    };\n    return PixelDustEngine;\n}());\n\nvar PixelDustApi = /** @class */ (function () {\n    function PixelDustApi(_a) {\n        var mountTarget = _a.mountTarget, _b = _a.dimension, dimension = _b === void 0 ? 800 : _b, layerStackUpdateCB = _a.layerStackUpdateCB, activeLayerUpdateCB = _a.activeLayerUpdateCB, _c = _a.canvasType, canvasType = _c === void 0 ? CanvasType.X100 : _c, _d = _a.initializeWithLayer, initializeWithLayer = _d === void 0 ? true : _d;\n        this.pixelDustEngine = new PixelDustEngine({ mountTarget: mountTarget, dimension: dimension, canvasType: canvasType });\n        if (this.pixelDustEngine.layerManager) {\n            this.pixelDustEngine.layerManager.layerStackUpdateCB = layerStackUpdateCB;\n            this.pixelDustEngine.layerManager.activeLayerUpdateCB = activeLayerUpdateCB;\n        }\n        else {\n            throw Error('Could not set layer manager callbacks');\n        }\n        if (initializeWithLayer) {\n            this.addLayerAfter();\n            this.pixelDustEngine.layerManager.setActiveLayer({\n                uuid: this.pixelDustEngine.layerManager.layerStack[0].uuid\n            });\n        }\n    }\n    PixelDustApi.prototype.cleanUp = function () {\n        this.pixelDustEngine.cleanUp();\n    };\n    PixelDustApi.prototype.setForegroundColor = function (color) {\n        if (this.pixelDustEngine.commandGenerator.drawingState.foregroundColor)\n            this.pixelDustEngine.commandGenerator.drawingState.foregroundColor = color;\n    };\n    PixelDustApi.prototype.setBackgroundColor = function (color) {\n        if (this.pixelDustEngine.commandGenerator.drawingState.backgroundColor)\n            this.pixelDustEngine.commandGenerator.drawingState.backgroundColor = color;\n    };\n    PixelDustApi.prototype.setInstrumentType = function (instrument) {\n        if (this.pixelDustEngine.commandGenerator.drawingState.instrument)\n            this.pixelDustEngine.commandGenerator.drawingState.instrument = instrument;\n    };\n    PixelDustApi.prototype.addLayerAfter = function (arg) {\n        this.pixelDustEngine.commandGenerator.layerCommand$.next(__assign({ type: LayerCommandType.ADD_AFTER }, arg));\n    };\n    PixelDustApi.prototype.addLayerBefore = function (arg) {\n        this.pixelDustEngine.commandGenerator.layerCommand$.next(__assign({ type: LayerCommandType.ADD_BEFORE }, arg));\n    };\n    PixelDustApi.prototype.hideLayer = function (arg) {\n        this.pixelDustEngine.commandGenerator.layerCommand$.next(__assign({ type: LayerCommandType.HIDE }, arg));\n    };\n    PixelDustApi.prototype.showLayer = function (arg) {\n        this.pixelDustEngine.commandGenerator.layerCommand$.next(__assign({ type: LayerCommandType.SHOW }, arg));\n    };\n    PixelDustApi.prototype.setActiveLayer = function (arg) {\n        this.pixelDustEngine.layerManager.setActiveLayer(arg);\n    };\n    PixelDustApi.prototype.deleteLayer = function (arg) {\n        this.pixelDustEngine.commandGenerator.layerCommand$.next(__assign({ type: LayerCommandType.DELETE }, arg));\n    };\n    PixelDustApi.prototype.insertLayerAfter = function (arg) {\n        this.pixelDustEngine.commandGenerator.layerCommand$.next(__assign({ type: LayerCommandType.INSERT_AFTER }, arg));\n    };\n    PixelDustApi.prototype.insertLayerBefore = function (arg) {\n        this.pixelDustEngine.commandGenerator.layerCommand$.next(__assign({ type: LayerCommandType.INSERT_BEFORE }, arg));\n    };\n    PixelDustApi.prototype.export = function () {\n        return this.pixelDustEngine.layerManager.exportImage();\n    };\n    return PixelDustApi;\n}());\n\nexport { CanvasType, InstrumentType, PixelDustApi as default };\n//# sourceMappingURL=index.js.map\n",null],"names":["extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","__extends","TypeError","String","__","constructor","create"],"mappings":"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"}